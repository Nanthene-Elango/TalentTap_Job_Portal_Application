<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalentTap - Job Seeker Registration</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <!-- Add SweetAlert2 CSS and JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <style>
        body {
            font-family: 'Poppins', Arial, sans-serif;
            background: linear-gradient(120deg, #f1f5f9, #d8e2ef);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .registration-container {
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 550px;
            padding: 35px;
            position: relative;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: none;
            border: none;
            color: #5e17eb;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        .progress-container {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin-bottom: 35px;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            width: 14.28%;
            background: #5e17eb;
            border-radius: 5px;
            transition: width 0.3s ease;
        }

        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-group label {
            display: block;
            font-size: 0.95rem;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 6px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            font-size: 0.95rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            border-color: #5e17eb;
            outline: none;
            box-shadow: 0 0 5px rgba(106, 90, 205, 0.2);
        }

        .form-control.error {
            border-color: #e74c3c;
            background: #fff1f1;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }

        .error-message.visible {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .otp-error {
            text-align: center;
            margin: 10px 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .btn {
            padding: 12px 25px;
            background: #5e17eb;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #4834d4;
        }

        .btn-secondary {
            background: #dcdcdc;
            color: #34495e;
        }

        .btn-secondary:hover {
            background: #b0b0b0;
        }

        .btn-group {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 25px;
        }

        .progress-btn {
            position: relative;
            overflow: hidden;
        }

        .progress-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background-color: rgba(255, 255, 255, 0.2);
            transition: width 0.3s linear;
        }

        .btn-text {
            position: relative;
            z-index: 2;
        }

        .otp-container {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 20px 0;
        }

        .otp-input {
            width: 45px;
            height: 45px;
            text-align: center;
            font-size: 1.1rem;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            transition: border-color 0.3s ease;
        }

        .otp-input:focus {
            border-color: #5e17eb;
            outline: none;
            box-shadow: 0 0 5px rgba(106, 90, 205, 0.2);
        }

        .otp-input:disabled {
            background: #f5f5f5;
            border-color: #e0e0e0;
            color: #555;
        }

        .verification-status {
            text-align: center;
            margin: 15px 0;
            font-size: 0.9rem;
        }

        .verified {
            color: #27ae60;
            font-weight: 600;
        }

        .verified::after {
            content: 'âœ”';
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            color: #27ae60;
        }

        .resend-container {
            text-align: center;
            margin: 10px 0;
            font-size: 0.9rem;
        }

        .resend-btn {
            background: none;
            border: none;
            color: #5e17eb;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
        }

        .resend-btn:disabled {
            color: #7f8c8d;
            cursor: not-allowed;
            text-decoration: none;
        }

        .change-number-btn, .change-email-btn {
            background: none;
            border: none;
            color: #5e17eb;
            font-weight: 600;
            cursor: pointer;
            text-decoration: underline;
            margin-top: 10px;
            display: none;
        }

        .skills-search-container {
            position: relative;
            margin-bottom: 20px;
        }

        .skills-search {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            font-size: 0.95rem;
            box-sizing: border-box;
            transition: border-color 0.3s ease;
        }

        .skills-search:focus {
            border-color: #5e17eb;
            outline: none;
            box-shadow: 0 0 5px rgba(106, 90, 205, 0.2);
        }

        .skills-list {
            position: absolute;
            width: 100%;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #dcdcdc;
            border-radius: 8px;
            background: #fff;
            z-index: 10;
            display: none;
            margin-top: 5px;
        }

        .skills-list.visible {
            display: block;
        }

        .skill-option {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 0.95rem;
            color: #34495e;
            user-select: none;
        }

        .skill-option:hover {
            background: #f1f5f9;
        }

        .selected-skills {
            min-height: 40px;
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .skill-tag {
            background: #5e17eb;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .skill-tag .remove-skill {
            cursor: pointer;
            font-size: 0.8rem;
        }

        @media (max-width: 576px) {
            .registration-container { padding: 20px; max-width: 100%; }
            .form-control, .otp-input { font-size: 0.9rem; }
            .btn { padding: 10px 20px; font-size: 0.9rem; }
            .otp-input { width: 40px; height: 40px; }
        }
    </style>
</head>

<body>
    <div class="registration-container">
        <button class="back-button" onclick="window.history.back()">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div style="display: flex; justify-content: center; margin: 40px;">
            <img src="./img/LOGO_TRANSPARENT.png" alt="Logo" style="height: 60px;">
        </div>
        <div class="progress-container">
            <div class="progress-bar-fill" id="progressBarFill"></div>
        </div>

        <form id="registrationForm">
            <div class="form-step active" id="basicDetailsStep">
                <h2>Basic Details</h2>
                <div class="form-group">
                    <label for="fullName">Full Name</label>
                    <input type="text" class="form-control" id="fullName" placeholder="Enter your full name">
                    <div class="error-message" id="fullNameError"></div>
                </div>
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" class="form-control" id="username" placeholder="Choose a username">
                    <div class="error-message" id="usernameError"></div>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" class="form-control" id="password" placeholder="Enter your password">
                    <div class="error-message" id="passwordError"></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn next-btn progress-btn" data-step="1">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Next</span>
                    </button>
                </div>
            </div>

            <div class="form-step" id="phoneVerificationStep">
                <h2>Phone Verification</h2>
                <div class="form-group">
                    <label for="phoneNumber">Phone Number</label>
                    <input type="tel" class="form-control" id="phoneNumber" placeholder="Enter your phone number" maxlength="10">
                    <div class="error-message" id="phoneNumberError"></div>
                </div>
                <p id="phoneOtpMessage" style="display: none;">
                    Code sent to: <span id="displayPhone"></span>
                </p>
                <div class="otp-container" id="phoneOtpContainer" style="display: none;">
                    <input type="text" maxlength="1" class="otp-input" id="phoneOtp1">
                    <input type="text" maxlength="1" class="otp-input" id="phoneOtp2">
                    <input type="text" maxlength="1" class="otp-input" id="phoneOtp3">
                    <input type="text" maxlength="1" class="otp-input" id="phoneOtp4">
                    <input type="text" maxlength="1" class="otp-input" id="phoneOtp5">
                    <input type="text" maxlength="1" class="otp-input" id="phoneOtp6">
                </div>
                <div class="error-message otp-error" id="otpPhoneError"></div>
                <div class="resend-container" id="phoneResendContainer" style="display: none;">
                    <button type="button" class="resend-btn" id="phoneResendBtn" disabled>Resend OTP</button>
                    <span id="phoneTimer"></span>
                </div>
                <div class="verification-status" id="phoneStatus"></div>
                <button type="button" class="change-number-btn" id="changePhoneBtn">Change Number</button>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary prev-btn" data-step="2">Previous</button>
                    <button type="button" class="btn progress-btn" id="phoneVerifyBtn" style="display: block;">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Get OTP</span>
                    </button>
                    <button type="button" class="btn progress-btn" id="phoneNextBtn" style="display: none;">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Verify</span>
                    </button>
                    <button type="button" class="btn progress-btn next-btn" id="phoneSkipBtn" style="display: none;" data-step="2">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Next</span>
                    </button>
                </div>
            </div>

            <div class="form-step" id="emailVerificationStep">
                <h2>Email Verification</h2>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter your email">
                    <div class="error-message" id="emailError"></div>
                </div>
                <p id="emailOtpMessage" style="display: none;">
                    Code sent to: <span id="displayEmail"></span>
                </p>
                <div class="otp-container" id="emailOtpContainer" style="display: none;">
                    <input type="text" maxlength="1" class="otp-input" id="otp1">
                    <input type="text" maxlength="1" class="otp-input" id="otp2">
                    <input type="text" maxlength="1" class="otp-input" id="otp3">
                    <input type="text" maxlength="1" class="otp-input" id="otp4">
                    <input type="text" maxlength="1" class="otp-input" id="otp5">
                    <input type="text" maxlength="1" class="otp-input" id="otp6">
                </div>
                <div class="error-message otp-error" id="otpEmailError"></div>
                <div class="resend-container" id="emailResendContainer" style="display: none;">
                    <button type="button" class="resend-btn" id="emailResendBtn" disabled>Resend OTP</button>
                    <span id="emailTimer"></span>
                </div>
                <div class="verification-status" id="emailStatus"></div>
                <button type="button" class="change-email-btn" id="changeEmailBtn">Change Email</button>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary prev-btn" data-step="3">Previous</button>
                    <button type="button" class="btn progress-btn" id="emailVerifyBtn" style="display: block;">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Get OTP</span>
                    </button>
                    <button type="button" class="btn progress-btn" id="emailNextBtn" style="display: none;">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Verify</span>
                    </button>
                    <button type="button" class="btn progress-btn next-btn" id="emailSkipBtn" style="display: none;" data-step="3">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Next</span>
                    </button>
                </div>
            </div>

            <div class="form-step" id="professionalDetailsStep">
                <h2>Professional Details</h2>
                <div class="form-group">
                    <label for="yearsOfExperience">Years of Experience</label>
                    <input type="number" class="form-control" id="yearsOfExperience" placeholder="Enter years of experience" min="0">
                    <div class="error-message" id="yearsOfExperienceError"></div>
                </div>
                <div class="form-group">
                    <label for="location">Location</label>
                    <select class="form-control" id="location">
                        <option value="" disabled selected>Select location</option>
                        <option value="chennai">Chennai</option>
                        <option value="bangalore">Bangalore</option>
                        <option value="mumbai">Mumbai</option>
                        <option value="delhi">Delhi</option>
                        <option value="other">Other</option>
                    </select>
                    <div class="error-message" id="locationError"></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary prev-btn" data-step="4">Previous</button>
                    <button type="button" class="btn next-btn progress-btn" data-step="4">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Next</span>
                    </button>
                </div>
            </div>

            <div class="form-step" id="educationDetailsStep">
                <h2>Education Details</h2>
                <div class="form-group">
                    <label for="highestQualification">Highest Qualification</label>
                    <select class="form-control" id="highestQualification">
                        <option value="" disabled selected>Select qualification</option>
                        <option value="10th">10th</option>
                        <option value="12th">12th</option>
                        <option value="ug">Undergraduate (UG)</option>
                        <option value="pg">Postgraduate (PG)</option>
                    </select>
                    <div class="error-message" id="highestQualificationError"></div>
                </div>
                <div class="form-group" id="boardOfStudyGroup" style="display: none;">
                    <label for="boardOfStudy">Board of Study</label>
                    <input type="text" class="form-control" id="boardOfStudy" placeholder="Enter board of study">
                    <div class="error-message" id="boardOfStudyError"></div>
                </div>
                <div class="form-group" id="degreeGroup" style="display: none;">
                    <label for="degree">Degree</label>
                    <input type="text" class="form-control" id="degree" placeholder="Enter your degree">
                    <div class="error-message" id="degreeError"></div>
                </div>
                <div class="form-group">
                    <label for="university">University/Institution</label>
                    <input type="text" class="form-control" id="university" placeholder="Enter university/institution">
                    <div class="error-message" id="universityError"></div>
                </div>
                <div class="form-group">
                    <label for="startYear">Starting Year</label>
                    <select class="form-control" id="startYear">
                        <option value="" disabled selected>Select starting year</option>
                    </select>
                    <div class="error-message" id="startYearError"></div>
                </div>
                <div class="form-group">
                    <label for="endYear">End Year</label>
                    <select class="form-control" id="endYear" disabled>
                        <option value="" disabled selected>Select end year</option>
                    </select>
                    <div class="error-message" id="endYearError"></div>
                </div>
                <div class="form-group">
                    <label for="percentage">Percentage</label>
                    <input type="number" class="form-control" id="percentage" placeholder="Enter percentage" min="0" max="100" step="0.01">
                    <div class="error-message" id="percentageError"></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary prev-btn" data-step="5">Previous</button>
                    <button type="button" class="btn next-btn progress-btn" data-step="5">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Next</span>
                    </button>
                </div>
            </div>

            <div class="form-step" id="keySkillsStep">
                <h2>Key Skills</h2>
                <div class="form-group">
                    <label for="keySkills">Select Your Skills</label>
                    <div class="skills-search-container">
                        <div class="selected-skills" id="selectedSkills"></div>
                        <input type="text" class="skills-search form-control" id="skillsSearch" placeholder="Search skills...">
                        <div class="skills-list" id="skillsList"></div>
                    </div>
                    <div class="error-message" id="keySkillsError"></div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary prev-btn" data-step="6">Previous</button>
                    <button type="button" class="btn next-btn progress-btn" data-step="6">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Next</span>
                    </button>
                </div>
            </div>

            <div class="form-step" id="confirmationStep">
                <h2>Review Details</h2>
                <div id="summaryDetails"></div>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary prev-btn" data-step="7">Previous</button>
                    <button type="submit" class="btn progress-btn" id="submitBtn">
                        <div class="progress-fill"></div>
                        <span class="btn-text">Submit</span>
                    </button>
                </div>
            </div>
        </form>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        $(document).ready(function() {
            let currentStep = 1;
            let emailVerified = false;
            let phoneVerified = false;
            let phoneResendTimer = 30;
            let emailResendTimer = 30;
            let phoneTimerInterval, emailTimerInterval;
            let verifiedPhoneNumber = null;
            let verifiedEmail = null;
            let phoneAttempts = 0;
            let emailAttempts = 0;
            let selectedSkills = [];

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            const passwordRegex = /^(?=.*[A-Z])(?=.*[a-z])(?=.*\d)(?=.*[@#$%^&*])[A-Za-z\d@#$%^&*]{8,}$/;
            const fullNameRegex = /^[A-Za-z\s]+$/;
            const usernameRegex = /^[A-Za-z0-9]+$/;
            const phoneRegex = /^\d{10}$/;
            const textOnlyRegex = /^[A-Za-z\s]+$/;

            const skills = [
                'JavaScript', 'Python', 'Java', 'C++', 'React',
                'Node.js', 'SQL', 'HTML', 'CSS', 'Git',
                'Angular', 'TypeScript', 'MongoDB', 'AWS', 'Docker'
            ];

            const currentYear = new Date().getFullYear();
            for (let year = currentYear; year >= 1970; year--) {
                $('#startYear').append(`<option value="${year}">${year}</option>`);
            }

            function showToast(message) {
                $('#toast').text(message).addClass('show');
                setTimeout(() => $('#toast').removeClass('show'), 3000);
            }

            function showError(element, message) {
                $(`#${element}Error`).text(message).addClass('visible');
                $(`#${element}`).addClass('error');
            }

            function clearError(element) {
                $(`#${element}Error`).text('').removeClass('visible');
                $(`#${element}`).removeClass('error');
            }

            function validateFullNameDynamic() {
                const val = $('#fullName').val().trim();
                if (!val) showError('fullName', 'Full name is required');
                else if (!fullNameRegex.test(val)) showError('fullName', 'Only letters and spaces allowed');
                else clearError('fullName');
            }

            function validateUsernameDynamic() {
                const val = $('#username').val().trim();
                if (!val) showError('username', 'Username is required');
                else if (!usernameRegex.test(val)) showError('username', 'Only letters and numbers allowed');
                else clearError('username');
            }

            function validatePasswordDynamic() {
                const val = $('#password').val();
                if (!val) showError('password', 'Password is required');
                else if (!passwordRegex.test(val)) showError('password', 'Must be 8+ chars with uppercase, lowercase, number, and special char');
                else clearError('password');
            }

            function validatePhoneNumberDynamic() {
                const val = $('#phoneNumber').val().trim();
                if (!val) showError('phoneNumber', 'Phone number is required');
                else if (!phoneRegex.test(val)) showError('phoneNumber', 'Must be exactly 10 digits');
                else clearError('phoneNumber');
                return phoneRegex.test(val);
            }

            function validateEmailDynamic() {
                const val = $('#email').val().trim();
                if (!val) showError('email', 'Email is required');
                else if (!emailRegex.test(val)) showError('email', 'Invalid email format');
                else clearError('email');
                return emailRegex.test(val);
            }

            function validateBoardOfStudyDynamic() {
                const val = $('#boardOfStudy').val().trim();
                if ($('#boardOfStudyGroup').is(':visible')) {
                    if (!val) showError('boardOfStudy', 'Board of study is required');
                    else if (!textOnlyRegex.test(val)) showError('boardOfStudy', 'Only letters and spaces allowed');
                    else clearError('boardOfStudy');
                }
            }

            function validateUniversityDynamic() {
                const val = $('#university').val().trim();
                if (!val) showError('university', 'University is required');
                else if (!textOnlyRegex.test(val)) showError('university', 'Only letters and spaces allowed');
                else clearError('university');
            }

            function validatePercentageDynamic() {
                const val = $('#percentage').val();
                if (!val) {
                    showError('percentage', 'Percentage is required');
                } else if (val < 0 || val > 100) {
                    showError('percentage', 'Must be between 0 and 100');
                } else {
                    clearError('percentage');
                }
            }

            function validateBasicDetails() {
                validateFullNameDynamic();
                validateUsernameDynamic();
                validatePasswordDynamic();
                return !$('#fullName').hasClass('error') && 
                       !$('#username').hasClass('error') && 
                       !$('#password').hasClass('error');
            }

            function validatePhoneNumber() {
                validatePhoneNumberDynamic();
                return !$('#phoneNumber').hasClass('error');
            }

            function validateEmail() {
                validateEmailDynamic();
                return !$('#email').hasClass('error');
            }

            function validateProfessionalDetails() {
                const years = $('#yearsOfExperience').val();
                const location = $('#location').val();
                let isValid = true;

                if (!years || years < 0) {
                    showError('yearsOfExperience', years ? 'Must be 0 or greater' : 'Required');
                    isValid = false;
                } else clearError('yearsOfExperience');

                if (!location) {
                    showError('location', 'Please select a location');
                    isValid = false;
                } else clearError('location');

                return isValid;
            }

            function validateEducationDetails() {
                let isValid = true;
                const qual = $('#highestQualification').val();
                const degree = $('#degree').val()?.trim();
                const startYear = $('#startYear').val();
                const endYear = $('#endYear').val();

                if (!qual) {
                    showError('highestQualification', 'Please select a qualification');
                    isValid = false;
                } else {
                    clearError('highestQualification');
                    if (qual === 'ug' || qual === 'pg') {
                        if (!degree) {
                            showError('degree', 'Degree is required');
                            isValid = false;
                        } else clearError('degree');
                    }
                }

                validateBoardOfStudyDynamic();
                validateUniversityDynamic();
                validatePercentageDynamic();

                if (!startYear) {
                    showError('startYear', 'Please select a starting year');
                    isValid = false;
                } else clearError('startYear');

                if (!endYear) {
                    showError('endYear', 'Please select an end year');
                    isValid = false;
                } else if (parseInt(endYear) < parseInt(startYear)) {
                    showError('endYear', 'End year must be after start year');
                    isValid = false;
                } else clearError('endYear');

                return isValid && 
                       !$('#boardOfStudy').hasClass('error') && 
                       !$('#university').hasClass('error') && 
                       !$('#percentage').hasClass('error');
            }

            function validateKeySkills() {
                if (selectedSkills.length === 0) {
                    showError('keySkills', 'Please select at least one skill');
                    return false;
                }
                clearError('keySkills');
                return true;
            }

            function disableOTPInputs(type) {
                const otpInputs = type === 'email' 
                    ? ['otp1', 'otp2', 'otp3', 'otp4', 'otp5', 'otp6']
                    : ['phoneOtp1', 'phoneOtp2', 'phoneOtp3', 'phoneOtp4', 'phoneOtp5', 'phoneOtp6'];
                otpInputs.forEach(id => $(`#${id}`).prop('disabled', true).removeClass('error'));
            }

            function resetVerification(type) {
                if (type === 'phone') {
                    phoneVerified = false;
                    verifiedPhoneNumber = null;
                    $('#phoneNumber').prop('disabled', false);
                    $('#phoneOtpContainer input').val('').prop('disabled', false);
                    $('#phoneOtpContainer, #phoneResendContainer, #phoneNextBtn, #changePhoneBtn, #phoneSkipBtn').hide();
                    $('#phoneVerifyBtn').show();
                    $('#phoneStatus').removeClass('verified').text('');
                    $('#phoneOtpMessage').hide();
                    clearInterval(phoneTimerInterval);
                    phoneAttempts = 0;
                } else {
                    emailVerified = false;
                    verifiedEmail = null;
                    $('#email').prop('disabled', false);
                    $('#emailOtpContainer input').val('').prop('disabled', false);
                    $('#emailOtpContainer, #emailResendContainer, #emailNextBtn, #changeEmailBtn, #emailSkipBtn').hide();
                    $('#emailVerifyBtn').show();
                    $('#emailStatus').removeClass('verified').text('');
                    $('#emailOtpMessage').hide();
                    clearInterval(emailTimerInterval);
                    emailAttempts = 0;
                }
            }

            function updateProgressBar() {
                const progressPercentage = (currentStep / 7) * 100;
                $('#progressBarFill').css('width', `${progressPercentage}%`);
            }

            function showStep(stepNumber) {
                $('.form-step').removeClass('active');
                $(`#${getStepName(stepNumber)}Step`).addClass('active');
                
                if (stepNumber === 2 && phoneVerified && verifiedPhoneNumber === $('#phoneNumber').val()) {
                    $('#phoneOtpContainer, #phoneResendContainer, #phoneVerifyBtn, #phoneNextBtn').hide();
                    $('#phoneResendBtn').prop('disabled', true);
                    $('#changePhoneBtn, #phoneSkipBtn').show();
                    $('#phoneStatus').addClass('verified').text('Verified');
                    disableOTPInputs('phone');
                }
                
                if (stepNumber === 3 && emailVerified && verifiedEmail === $('#email').val()) {
                    $('#emailOtpContainer, #emailResendContainer, #emailVerifyBtn, #emailNextBtn').hide();
                    $('#emailResendBtn').prop('disabled', true);
                    $('#changeEmailBtn, #emailSkipBtn').show();
                    $('#emailStatus').addClass('verified').text('Verified');
                    disableOTPInputs('email');
                }

                if (stepNumber === 6) {
                    updateSelectedSkills();
                    populateSkillsList(skills);
                }
            }

            function getStepName(stepNumber) {
                switch(stepNumber) {
                    case 1: return 'basicDetails';
                    case 2: return 'phoneVerification';
                    case 3: return 'emailVerification';
                    case 4: return 'professionalDetails';
                    case 5: return 'educationDetails';
                    case 6: return 'keySkills';
                    case 7: return 'confirmation';
                }
            }

            function animateProgressButton(button, callback) {
                const progressFill = button.find('.progress-fill');
                progressFill.css('width', '0%');
                button.prop('disabled', true);
                progressFill.animate({ width: '100%' }, 1000, function() {
                    button.prop('disabled', false);
                    if (callback) callback();
                });
            }

            function startResendTimer(type) {
                const timerElement = $(`#${type}Timer`);
                const resendBtn = $(`#${type}ResendBtn`);
                let timeLeft = type === 'phone' ? phoneResendTimer : emailResendTimer;
                timerElement.text(` (Resend in ${timeLeft}s)`);
                resendBtn.prop('disabled', true);

                const interval = setInterval(() => {
                    timeLeft--;
                    timerElement.text(` (Resend in ${timeLeft}s)`);
                    if (timeLeft <= 0) {
                        clearInterval(interval);
                        timerElement.text('');
                        if ((type === 'phone' && !phoneVerified) || (type === 'email' && !emailVerified)) {
                            resendBtn.prop('disabled', false);
                        }
                    }
                }, 1000);

                if (type === 'phone') phoneTimerInterval = interval;
                else emailTimerInterval = interval;
            }

            function sendPhoneOTP() {
                if (!validatePhoneNumber()) return;
                animateProgressButton($('#phoneVerifyBtn'), function() {
                    const phone = $('#phoneNumber').val();
                    $('#phoneNumber').prop('disabled', true);
                    $('#displayPhone').text(phone.replace(/.(?=.{4})/g, '*'));
                    $('#phoneOtpMessage, #phoneOtpContainer, #phoneResendContainer').show();
                    $('#phoneVerifyBtn').hide();
                    $('#phoneNextBtn').show();
                    $('#phoneStatus').text('Enter the OTP');
                    $('#phoneOtp1').focus();
                    startResendTimer('phone');
                });
            }

            function sendEmailOTP() {
                if (!validateEmail()) return;
                animateProgressButton($('#emailVerifyBtn'), function() {
                    const email = $('#email').val();
                    $('#email').prop('disabled', true);
                    $('#displayEmail').text(email.replace(/(?<=.{3}).(?=[^@]*@)/g, '*'));
                    $('#emailOtpMessage, #emailOtpContainer, #emailResendContainer').show();
                    $('#emailVerifyBtn').hide();
                    $('#emailNextBtn').show();
                    $('#emailStatus').text('Enter the OTP');
                    $('#otp1').focus();
                    startResendTimer('email');
                });
            }

            function verifyOTP(type) {
                const otpInputs = type === 'email' 
                    ? ['otp1', 'otp2', 'otp3', 'otp4', 'otp5', 'otp6']
                    : ['phoneOtp1', 'phoneOtp2', 'phoneOtp3', 'phoneOtp4', 'phoneOtp5', 'phoneOtp6'];
                const enteredOTP = otpInputs.map(id => $(`#${id}`).val()).join('');
                
                if (enteredOTP.length !== 6) {
                    $(`#otp${type === 'email' ? 'Email' : 'Phone'}Error`)
                        .text('Please enter all 6 digits')
                        .addClass('visible');
                    return;
                } else {
                    $(`#otp${type === 'email' ? 'Email' : 'Phone'}Error`).text('').removeClass('visible');
                }

                const verifyBtn = type === 'email' ? $('#emailNextBtn') : $('#phoneNextBtn');
                if (type === 'email') emailAttempts++;
                else phoneAttempts++;

                if ((type === 'email' && emailAttempts > 3) || (type === 'phone' && phoneAttempts > 3)) {
                    showToast('Maximum OTP attempts reached');
                    verifyBtn.prop('disabled', true);
                    return;
                }

                animateProgressButton(verifyBtn, function() {
                    const statusElement = $(`#${type}Status`);
                    statusElement.text('Verifying...');

                    setTimeout(() => {
                        const isValidOTP = true; // Simulated validation
                        if (isValidOTP) {
                            if (type === 'phone') {
                                phoneVerified = true;
                                verifiedPhoneNumber = $('#phoneNumber').val();
                                disableOTPInputs('phone');
                                $('#phoneNextBtn').hide();
                                $('#phoneSkipBtn, #changePhoneBtn').show();
                                $('#phoneResendBtn').prop('disabled', true);
                            } else {
                                emailVerified = true;
                                verifiedEmail = $('#email').val();
                                disableOTPInputs('email');
                                $('#emailNextBtn').hide();
                                $('#emailSkipBtn, #changeEmailBtn').show();
                                $('#emailResendBtn').prop('disabled', true);
                            }
                            statusElement.addClass('verified').text('Verified');
                        } else {
                            $(`#otp${type === 'email' ? 'Email' : 'Phone'}Error`)
                                .text('Invalid OTP')
                                .addClass('visible');
                            statusElement.text('');
                        }
                    }, 1000);
                });
            }

            function prepareConfirmation() {
                const fullName = $('#fullName').val().trim();
                const username = $('#username').val().trim();
                const phone = $('#phoneNumber').val().trim();
                const email = $('#email').val().trim();
                const yearsOfExperience = $('#yearsOfExperience').val();
                const location = $('#location option:selected').text();
                const highestQualification = $('#highestQualification option:selected').text();
                const boardOfStudy = $('#boardOfStudy').val()?.trim();
                const degree = $('#degree').val()?.trim();
                const university = $('#university').val().trim();
                const startYear = $('#startYear').val();
                const endYear = $('#endYear').val();
                const percentage = $('#percentage').val();
                const skillsList = selectedSkills.join(', ');

                let html = `
                    <p><strong>Full Name:</strong> ${fullName}</p>
                    <p><strong>Username:</strong> ${username}</p>
                    <p><strong>Phone:</strong> ${phone}</p>
                    <p><strong>Email:</strong> ${email}</p>
                    <p><strong>Years of Experience:</strong> ${yearsOfExperience}</p>
                    <p><strong>Location:</strong> ${location}</p>
                    <p><strong>Highest Qualification:</strong> ${highestQualification}</p>
                `;
                if (highestQualification.includes('10th') || highestQualification.includes('12th')) {
                    html += `<p><strong>Board of Study:</strong> ${boardOfStudy}</p>`;
                } else {
                    html += `<p><strong>Degree:</strong> ${degree}</p>`;
                }
                html += `
                    <p><strong>University/Institution:</strong> ${university}</p>
                    <p><strong>Start Year:</strong> ${startYear}</p>
                    <p><strong>End Year:</strong> ${endYear}</p>
                    <p><strong>Percentage:</strong> ${percentage}</p>
                    <p><strong>Key Skills:</strong> ${skillsList}</p>
                `;
                $('#summaryDetails').html(html);
            }

            // Skills Functions
            function updateSelectedSkills() {
                $('#selectedSkills').empty();
                selectedSkills.forEach(skill => {
                    $('#selectedSkills').append(`
                        <span class="skill-tag">
                            ${skill}
                            <i class="fas fa-times remove-skill" data-skill="${skill}"></i>
                        </span>
                    `);
                });
            }

            function populateSkillsList(skillsToShow) {
                const $skillsList = $('#skillsList');
                $skillsList.empty();
                const availableSkills = skillsToShow.filter(skill => !selectedSkills.includes(skill));
                
                if (availableSkills.length === 0) {
                    $skillsList.html('<div class="skill-option">No skills available</div>');
                    return;
                }

                availableSkills.forEach(skill => {
                    $skillsList.append(`
                        <div class="skill-option" data-skill="${skill}">
                            ${skill}
                        </div>
                    `);
                });
            }

            // Event Handlers
            $('#fullName').on('input', validateFullNameDynamic);
            $('#username').on('input', validateUsernameDynamic);
            $('#password').on('input', validatePasswordDynamic);

            $('#phoneNumber').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10);
                validatePhoneNumberDynamic();
            });

            $('#email').on('input', validateEmailDynamic);

            $('#boardOfStudy').on('input', function() {
                this.value = this.value.replace(/[^A-Za-z\s]/g, '');
                validateBoardOfStudyDynamic();
            });

            $('#university').on('input', function() {
                this.value = this.value.replace(/[^A-Za-z\s]/g, '');
                validateUniversityDynamic();
            });

            $('#percentage').on('input', function() {
                const val = $(this).val();
                if (val) {
                    const numVal = parseFloat(val);
                    if (numVal < 0) $(this).val(0);
                    if (numVal > 100) $(this).val(100);
                }
                validatePercentageDynamic();
            });

            $('#skillsSearch').on('input', function() {
                const query = $(this).val().trim().toLowerCase();
                const filteredSkills = skills.filter(skill => 
                    skill.toLowerCase().includes(query) && !selectedSkills.includes(skill)
                );
                populateSkillsList(filteredSkills);
                $('#skillsList').addClass('visible');
            });

            $('#skillsSearch').on('focus', function() {
                const query = $(this).val().trim().toLowerCase();
                const filteredSkills = query 
                    ? skills.filter(skill => skill.toLowerCase().includes(query) && !selectedSkills.includes(skill))
                    : skills.filter(skill => !selectedSkills.includes(skill));
                populateSkillsList(filteredSkills);
                $('#skillsList').addClass('visible');
            });

            $('#skillsSearch').on('blur', function() {
                setTimeout(() => $('#skillsList').removeClass('visible'), 150);
            });

            $(document).on('mousedown', '.skill-option', function(e) {
                e.preventDefault();
                const skill = $(this).data('skill');
                if (skill && !selectedSkills.includes(skill)) {
                    selectedSkills.push(skill);
                    updateSelectedSkills();
                    clearError('keySkills');
                    $('#skillsSearch').val('').focus();
                    populateSkillsList(skills);
                    $('#skillsList').addClass('visible');
                }
            });

            $(document).on('click', '.remove-skill', function(e) {
                e.stopPropagation();
                const skill = $(this).data('skill');
                selectedSkills = selectedSkills.filter(s => s !== skill);
                updateSelectedSkills();
                populateSkillsList(skills);
                $('#skillsSearch').focus();
            });

            $('#startYear').on('change', function() {
                const startYear = parseInt($(this).val());
                const endYearSelect = $('#endYear');
                endYearSelect.empty().append('<option value="" disabled selected>Select end year</option>');

                if (startYear) {
                    for (let year = startYear; year <= currentYear; year++) {
                        endYearSelect.append(`<option value="${year}">${year}</option>`);
                    }
                    endYearSelect.prop('disabled', false);
                } else {
                    endYearSelect.prop('disabled', true);
                }
            });

            $('.next-btn').click(function() {
                const step = parseInt($(this).data('step'));
                if (step === 1 && !validateBasicDetails()) return;
                if (step === 2 && !phoneVerified) {
                    showToast('Please verify your phone number');
                    return;
                }
                if (step === 3 && !emailVerified) {
                    showToast('Please verify your email');
                    return;
                }
                if (step === 4 && !validateProfessionalDetails()) return;
                if (step === 5 && !validateEducationDetails()) return;
                if (step === 6 && !validateKeySkills()) return;

                animateProgressButton($(this), function() {
                    if (step === 6) prepareConfirmation();
                    currentStep = step + 1;
                    showStep(currentStep);
                    updateProgressBar();
                });
            });

            $('.prev-btn').click(function() {
                currentStep = parseInt($(this).data('step')) - 1;
                showStep(currentStep);
                updateProgressBar();
            });

            $('.otp-input').on('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
                if (this.value.length === 1) {
                    $(this).next('.otp-input:not(:disabled)').focus();
                }
            });

            $('.otp-input').on('keydown', function(e) {
                if (e.key === 'Backspace' && !$(this).val()) {
                    $(this).prev('.otp-input:not(:disabled)').focus();
                }
            });

            $('#phoneVerifyBtn').click(sendPhoneOTP);
            $('#phoneNextBtn').click(function() { verifyOTP('phone'); });

            $('#emailVerifyBtn').click(sendEmailOTP);
            $('#emailNextBtn').click(function() { verifyOTP('email'); });

            $('#phoneResendBtn').click(function() {
                if (!phoneVerified) {
                    $('#phoneOtpContainer input').val('');
                    $('#phoneOtp1').focus();
                    $('#phoneStatus').text('Enter the OTP');
                    $('#otpPhoneError').text('').removeClass('visible');
                    phoneAttempts = 0;
                    $('#phoneNextBtn').prop('disabled', false);
                    startResendTimer('phone');
                }
            });

            $('#emailResendBtn').click(function() {
                if (!emailVerified) {
                    $('#emailOtpContainer input').val('');
                    $('#otp1').focus();
                    $('#emailStatus').text('Enter the OTP');
                    $('#otpEmailError').text('').removeClass('visible');
                    emailAttempts = 0;
                    $('#emailNextBtn').prop('disabled', false);
                    startResendTimer('email');
                }
            });

            $('#changePhoneBtn').click(function() {
                resetVerification('phone');
                $('#phoneNumber').val('').focus();
            });

            $('#changeEmailBtn').click(function() {
                resetVerification('email');
                $('#email').val('').focus();
            });

            $('#highestQualification').change(function() {
                const val = $(this).val();
                if (val === '10th' || val === '12th') {
                    $('#boardOfStudyGroup').show();
                    $('#degreeGroup').hide();
                    $('#degree').val('');
                } else if (val === 'ug' || val === 'pg') {
                    $('#boardOfStudyGroup').hide();
                    $('#degreeGroup').show();
                    $('#boardOfStudy').val('');
                } else {
                    $('#boardOfStudyGroup, #degreeGroup').hide();
                    $('#boardOfStudy, #degree').val('');
                }
                clearError('highestQualification');
            });

            $('#registrationForm').submit(function(e) {
                e.preventDefault();
                animateProgressButton($('#submitBtn'), function() {
                    Swal.fire({
                        title: 'Success!',
                        text: 'Registration completed successfully!',
                        icon: 'success',
                        confirmButtonText: 'OK',
                        confirmButtonColor: '#5e17eb'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Redirect to dashboard page
                            window.location.href = 'dashboard.html';
                        }
                    });
                });
            });

            updateProgressBar();
        });
    </script>
</body>
</html>